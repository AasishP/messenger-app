(this["webpackJsonpmessenger-app"]=this["webpackJsonpmessenger-app"]||[]).push([[0],{184:function(e,t,n){},311:function(e,t){function n(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=311},312:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(23),i=n.n(c),s=(n(184),n(172)),o=n(390),l=n(42),u=n(17),d=n(345),m=n(392),j=n(3),b=n(8),f=n.n(b),p=n(18),h=n(347),O=n(315),x=n(71),g=n.n(x),v={address:"https://messenger-backend-server.herokuapp.com",wsAddress:"wss://messenger-backend-server.herokuapp.com"},y="".concat(v.address,"/api"),w=g.a.create({baseURL:y,headers:{"X-Requested-With":"XMLHttpRequest"}});w.interceptors.request.use((function(e){return e.url.includes("/login")&&e.data||e.url.includes("/userinfo")||(e.headers.Authorization="Bearer ".concat(localStorage.getItem("accesstoken"))),e}));var S=w,C=n(56),k=n(122),N=n(6),I=n(391),E=n(348),A=n(349),T=n(352),R=n(353),L=n(354),F=n(350),P=n(351),B=n(1),M=Object(d.a)({form:{width:"70%",maxWidth:"450px",minWidth:"300px"},formTitle:{margin:"0.5em"},btn:{width:"fit-content",margin:"1.5em 0",padding:"0.7em 4em",textTransform:"capitalize"},link:{textDecoration:"none",alignSelf:"flex-end"},divider:{width:"100%",height:"1.5px",marginBottom:"1.5em"},spinner:{position:"absolute",right:"15%"}}),U=Object(N.a)({root:{"& .MuiInputBase-input":{padding:"0.7em"}}})(I.a);function z(e){var t=e.formik,n=e.children,a=M();return Object(B.jsx)("form",{onSubmit:t.handleSubmit,className:a.form,children:Object(B.jsx)(m.a,{display:"flex",flexDirection:"column",alignItems:"center",p:"2em 3em",bgcolor:"white",boxShadow:"rgb(37 117 252 / 20%) 0px 2px 20px 0px",borderRadius:10,children:n})})}function G(e){var t=e.children,n=M();return Object(B.jsx)(O.a,{className:n.formTitle,variant:"h5",color:"primary",align:"center",children:t})}function W(e){var t=e.formik,n=e.name,a=Object(k.a)(e,["formik","name"]);return Object(B.jsx)(U,Object(C.a)(Object(C.a)({inputProps:a,variant:"outlined",fullWidth:!0,margin:"normal",name:n,placeholder:n,"aria-label":n},t.getFieldProps(n)),{},{error:Boolean(t.touched[n]&&t.errors[n]),helperText:t.touched[n]?t.errors[n]:""}))}function D(e){var t=e.formik,n=e.passwordVisible,a=e.setPasswordVisible,r=Object(k.a)(e,["formik","passwordVisible","setPasswordVisible"]);return Object(B.jsx)(U,Object(C.a)(Object(C.a)({inputProps:r,variant:"outlined",fullWidth:!0,margin:"normal",type:n?"text":"password",name:"password",placeholder:"Password","aria-label":"password"},t.getFieldProps("password")),{},{error:Boolean(t.touched.password&&t.errors.password),helperText:t.touched.password?t.errors.password:"",InputProps:{endAdornment:Object(B.jsx)(E.a,{children:Object(B.jsx)(A.a,{onClick:function(){return a(!n)},children:n?Object(B.jsx)(F.a,{color:"primary"}):Object(B.jsx)(P.a,{color:"primary"})})})}}))}function H(e){var t=e.children,n=(e.formik,e.loading),a=M();return Object(B.jsxs)(T.a,{type:"submit",className:a.btn,variant:"contained",color:"primary","aria-label":"login button",children:[t,n?Object(B.jsx)(R.a,{className:a.spinner,color:"inherit",size:"1.5em"}):null]})}function Y(e){var t=e.linkTo,n=e.children,a=e.linkText,r=M();return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(L.a,{variant:"middle",light:!0,className:r.divider}),Object(B.jsxs)(O.a,{variant:"body2",color:"textSecondary",children:[n," ",Object(B.jsxs)(l.b,{to:t,className:r.link,children:[Object(B.jsx)(O.a,{variant:"inherit",color:"primary",component:"span",children:a})," "]}),"here!"]})]})}var q=n(47),V=n(355),K=n(356),Z=n(357),X=n(358),J=n(359);var Q=function(e){var t,n=e.type,r=e.children,c=Object(q.a)(),i=Object(a.useState)(!0),s=Object(j.a)(i,2),o=s[0],l=s[1];return setTimeout((function(){l(!1)}),2e3),Object(B.jsx)(V.a,{direction:"down",in:o,timeout:{enter:300,exit:500},children:Object(B.jsxs)(m.a,{position:"absolute",display:"flex",top:"5%",marginRight:"auto",p:"1em",borderRadius:5,boxShadow:5,bgcolor:null===(t=c.palette)||void 0===t?void 0:t[n].main,children:["success"===n?Object(B.jsx)(K.a,{htmlColor:"white"}):null,"info"===n?Object(B.jsx)(Z.a,{htmlColor:"white"}):null,"warning"===n?Object(B.jsx)(X.a,{htmlColor:"white"}):null,"error"===n?Object(B.jsx)(J.a,{htmlColor:"white"}):null,Object(B.jsx)(O.a,{variant:"body1",style:{marginLeft:"0.5em",color:"white"},children:r})]})})},_=n(106),$=n(52),ee={username:"",password:""},te=function(){var e=Object(p.a)(f.a.mark((function e(t,n){var a,r,c,i,s;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.setLoggedIn,r=n.setLoading,c=n.setFormError,r(!0),e.prev=2,e.next=5,S.post("/login",t);case 5:200===(i=e.sent).status&&(window.localStorage.setItem("accesstoken",i.data.accesstoken),a(!0)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(2),r(!1),c({state:!0,message:(null===(s=e.t0.response)||void 0===s?void 0:s.data)||e.t0.message});case 13:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}(),ne=$.a({username:$.b().required("username cannot be empty!").min(4,"username must be at least 4 characters!").max(255,"username cannot exceed 255 characters!").matches(/[A-Za-z0-9._]{4,255}$/,"Only albabets dot(.) and underscore(_) is allowed!"),password:$.b().trim().required("password cannot be empty!").min(6,"password must be least 6 characters long!").max(255,"password cannot exceed 255 characters!").matches(/[\S]{6,255}$/,"password cannnot contain white space characters!")});var ae=function(e){var t=e.alert,n=Object(a.useState)({state:!1,message:""}),r=Object(j.a)(n,2),c=r[0],i=r[1],s=Object(a.useState)(!1),o=Object(j.a)(s,2),d=o[0],m=o[1],b=Object(a.useState)(!1),f=Object(j.a)(b,2),p=f[0],x=f[1],g=Object(a.useState)(!1),v=Object(j.a)(g,2),y=v[0],w=v[1],S=Object(_.a)({initialValues:ee,onSubmit:function(e){te(e,{setLoggedIn:w,setLoading:x,setFormError:i})},validationSchema:ne}),C=M();return y?Object(B.jsx)(u.a,{to:"/messenger"}):Object(B.jsxs)(B.Fragment,{children:[t?Object(B.jsx)(Q,{type:t.type,children:t.message}):null,Object(B.jsxs)(z,{formik:S,children:[Object(B.jsx)(G,{children:"Welcome Back"}),Object(B.jsx)(W,{name:"username",formik:S,autoFocus:!0}),Object(B.jsx)(D,{formik:S,passwordVisible:d,setPasswordVisible:m}),Object(B.jsx)(h.a,{error:c.state,children:c.message}),Object(B.jsx)(l.b,{to:"/",className:C.link,children:Object(B.jsx)(O.a,{variant:"subtitle1",color:"primary",children:"Forget Password?"})}),Object(B.jsx)(H,{formik:S,loading:p,children:"Sign In"}),Object(B.jsx)(Y,{linkTo:"/signup",linkText:"Sign Up",children:"Don't have an account ?"})]})]})},re={firstName:"",lastName:"",username:"",password:""},ce=function(){var e=Object(p.a)(f.a.mark((function e(t,n){var a,r,c,i;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n.setRegistered,r=n.setLoading,c=n.setFormError,r(!0),e.prev=2,e.next=5,S.post("/register",t);case 5:201===e.sent.status&&a(!0),e.next=14;break;case 9:e.prev=9,e.t0=e.catch(2),console.log(e.t0),c({state:!0,message:(null===(i=e.t0.response)||void 0===i?void 0:i.data)||e.t0.message}),r(!1);case 14:case"end":return e.stop()}}),e,null,[[2,9]])})));return function(t,n){return e.apply(this,arguments)}}(),ie=$.a({firstName:$.b().required("firstName cannot be empty!").min(3,"firstName must be at least 3 characters!").max(255,"firstName cannot exceed 255 characters!").matches(/[A-Za-z]{3,255}$/,"Invalid Characters!, use letters only."),lastName:$.b().required("lastName cannot be empty!").min(3,"lastName must be at least 3 characters!").max(255,"lastName cannot exceed 255 characters!").matches(/[A-Za-z]{3,255}$/,"Invalid Characters!, use letters only."),username:$.b().required("username cannot be empty!").min(4,"username must be at least 4 characters!").max(255,"username cannot exceed 255 characters!").matches(/[A-Za-z0-9._]{4,255}$/,"Only albabets dot(.) and underscore(_) is allowed!"),password:$.b().trim().required("password cannot be empty!").min(6,"password must be least 6 characters long!").max(255,"password cannot exceed 255 characters!").matches(/[\S]{6,255}$/,"password cannnot contain white space characters!")});var se=function(){var e=Object(a.useState)(!1),t=Object(j.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(!1),i=Object(j.a)(c,2),s=i[0],o=i[1],l=Object(a.useState)({state:!1,message:""}),d=Object(j.a)(l,2),b=d[0],f=d[1],p=Object(a.useState)(!1),O=Object(j.a)(p,2),x=O[0],g=O[1],v=Object(_.a)({initialValues:re,onSubmit:function(e){ce(e,{setRegistered:g,setLoading:o,setFormError:f})},validationSchema:ie});return x?Object(B.jsx)(u.a,{to:{pathname:"/login",state:{alert:{type:"success",message:"User Succesfully Registered!"}}}}):Object(B.jsxs)(z,{formik:v,children:[Object(B.jsx)(G,{children:"Lets Get Started."}),Object(B.jsxs)(m.a,{display:"flex",justifyContent:"space-between",children:[Object(B.jsx)(W,{name:"firstName",formik:v}),Object(B.jsx)("div",{style:{width:"1em"}}),Object(B.jsx)(W,{name:"lastName",formik:v})]}),Object(B.jsx)(W,{name:"username",formik:v}),Object(B.jsx)(D,{passwordVisible:n,setPasswordVisible:r,formik:v}),Object(B.jsx)(h.a,{error:b.state,children:b.message}),Object(B.jsx)(H,{formik:v,loading:s,children:"Sign Up"}),Object(B.jsx)(Y,{linkTo:"/login",linkText:"Sign In",children:"Already have an account ?"})]})},oe=n.p+"static/media/loginPageBackground.566fa2ff.svg",le=Object(d.a)({root:{background:"url(".concat(oe,")"),backgroundSize:"cover",backgroundPositionY:"100%"}});var ue=function(){var e,t=le(),n=Object(u.h)(),a=localStorage.getItem("accesstoken");return Boolean(a)?Object(B.jsx)(u.a,{to:"/messenger"}):Object(B.jsxs)(m.a,{className:t.root,display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",width:"100vw",children:[Object(B.jsx)(u.b,{path:"/",children:Object(B.jsx)(u.a,{to:{pathname:"/login",state:n.state}})}),Object(B.jsx)(u.b,{path:"/login",children:Object(B.jsx)(ae,{alert:null===(e=n.state)||void 0===e?void 0:e.alert})}),Object(B.jsx)(u.b,{path:"/signup",children:Object(B.jsx)(se,{})})]})},de=n(389),me=n(167),je=n(173),be=n(397),fe=n(360),pe=n(124),he=n(33),Oe=n.n(he),xe=Object(a.createContext)(),ge=Object(N.a)((function(){return{badge:{height:"0.9em",width:"0.9em",borderRadius:"50%",border:"2px solid #fff",backgroundColor:function(e){return e.isonline?"green":"grey"}}}}))(fe.a),ve=Object(d.a)({messageBadge:{marginLeft:"1em"}}),ye=Object(N.a)((function(e){return{buttonRipple:{color:e.palette.primary.main},main:{padding:"1em",width:"100%",justifyContent:"start","&:hover":{transform:"scale(1.01)",boxShadow:"rgb(145 158 171 / 24%) 0px 5px 16px 0px"}}}}))((function(e){return Object(B.jsx)(pe.a,{className:e.classes.main,TouchRippleProps:{classes:{root:e.classes.buttonRipple}},component:"div",onClick:e.onClick,children:e.children})}));function we(e){var t=e.msgTimestamp,n=Object(a.useState)((function(){s(t)})),r=Object(j.a)(n,2),c=r[0],i=r[1];function s(e){return Oe()(e).fromNow(!0).replace(/a few seconds| hours|a minute| minutes| days|an hour|a day/gi,(function(e){switch(e){case" hours":return"h";case" minutes":return"m";case" days":return"d";case" months":return"mth";case"a few seconds":return"Just Now";case"a minute":return"1m";case"an hour":return"1h";case"a day":return"1d";default:return e}}))}return Object(a.useEffect)((function(){i(s(t));var e=setInterval((function(){i(s(t))}),6e4);return function(){clearInterval(e)}}),[t]),Object(B.jsx)(O.a,{color:"textSecondary",style:{fontSize:"0.9rem"},children:c})}var Se=function(e){var t=e.lastMessage,n=e.conversationWith,r=ve(),c=Object(u.g)(),i=Object(a.useContext)(xe),s=Object(a.useState)({}),o=Object(j.a)(s,2),l=o[0],d=o[1],b=Object(a.useState)(!1),h=Object(j.a)(b,2),x=h[0],g=h[1],v=Object(a.useState)(t),y=Object(j.a)(v,2),w=y[0],C=y[1];function k(){return(k=Object(p.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get("/userinfo/".concat(t));case 2:n=e.sent,d(n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){function e(e,t){e===(null===l||void 0===l?void 0:l.username)&&g(t)}return i.on("onlineStateChange",e),function(){i.off("onlineStateChange",e)}}),[i,l]),Object(a.useEffect)((function(){g(l.online)}),[l.online]),Object(a.useEffect)((function(){function e(e){var t;e.from===n&&C(e),(null===(t=e.detail)||void 0===t?void 0:t.recipient)===n&&C(e.detail)}var t;return function(e){k.apply(this,arguments)}(n),i.on("receive-message",e),t=e,document.addEventListener("sendMessage",t),function(){i.off("receive-message",e),function(e){document.removeEventListener("sendMessage",e)}(e)}}),[t,n,i]),Object(B.jsxs)(ye,{onClick:function(){c.push("/messenger/".concat(n))},children:[Object(B.jsx)(ge,{isonline:x?1:0,overlap:"circle",badgeContent:"",variant:"dot",anchorOrigin:{vertical:"bottom",horizontal:"right"},children:Object(B.jsx)(be.a,{alt:l.username,src:l.profilePic})}),Object(B.jsxs)(m.a,{px:"0.8em",children:[Object(B.jsxs)(O.a,{color:"textPrimary",variant:"h6",style:{fontSize:"1.1rem"},children:[l.firstName," ",l.lastName]}),Object(B.jsxs)(O.a,{color:w.seen?"textSecondary":"textPrimary",component:"p",noWrap:!0,style:{width:"15.5rem",fontWeight:w.seen?"normal":"bold"},children:[w.from===l.username?"".concat(l.firstName,": "):"you: ",w.text||(w.media.images.length>0||w.media.videos.length>0||w.media.files.length>0)&&"sent an attatchment!"]})]}),Object(B.jsxs)(m.a,{marginLeft:"auto",display:"flex",alignItems:"center",children:[Object(B.jsx)(we,{msgTimestamp:w.timestamp}),Object(B.jsx)(fe.a,{className:r.messageBadge,color:"primary",variant:"dot"})]})]})},Ce=n(361),ke=n(362),Ne=Object(d.a)({header:{position:"absolute",backdropFilter:"blur(5px)",backgroundColor:"#ffffffc5",zIndex:"10",width:"100%",display:"flex",alignItems:"center",padding:"1em 2%",borderRadius:"0 0 5px 5px",boxShadow:"rgb(145 158 171 / 24%) 0px 8px 16px 0px"},largeAvatar:{height:"2.5em",width:"2.5em"},buttonIcon:{margin:"0 0.5em"},menu:{marginTop:"3em"}});var Ie=function(e){var t,n=e.userInfo,r=Ne(),c=Object(a.useContext)(xe),i=Object(a.useState)(n.online),s=Object(j.a)(i,2),o=s[0],l=s[1];function u(e){var t=new CustomEvent("call",{detail:{userInfo:n,callType:e}});document.dispatchEvent(t)}return Object(a.useEffect)((function(){function e(e,t){console.log("informed"),e===(null===n||void 0===n?void 0:n.username)&&l(t)}return c.on("onlineStateChange",e),function(){c.off("onlineStateChange",e)}}),[c,n]),Object(a.useEffect)((function(){l(n.online)}),[n.online]),Object(B.jsxs)(m.a,{className:r.header,children:[Object(B.jsx)(ge,{variant:"dot",badgeContent:" ",overlap:"circle",isonline:o?1:0,anchorOrigin:{vertical:"bottom",horizontal:"right"},children:Object(B.jsx)(be.a,{className:r.largeAvatar,alt:null===(t=n.username)||void 0===t?void 0:t.toUpperCase(),src:n.profilePic})}),Object(B.jsx)(m.a,{mx:"1em",children:Object(B.jsxs)(m.a,{display:"flex",flexDirection:"column",justifyContent:"center",children:[Object(B.jsxs)(O.a,{variant:"h6",color:"textPrimary",children:[n.firstName," ",n.lastName]}),Object(B.jsx)(O.a,{variant:"subtitle1",color:"textPrimary",children:n.username?"@".concat(n.username):""})]})}),Object(B.jsx)(m.a,{mx:"auto",mt:"auto",children:Object(B.jsx)(O.a,{variant:"subtitle1",color:"textSecondary",children:o?"Active Now":"Offline"})}),Object(B.jsxs)(m.a,{ml:"auto",display:"flex",flexWrap:"wrap",children:[Object(B.jsx)(A.a,{className:r.buttonIcon,onClick:function(){u("AudioCall")},children:Object(B.jsx)(Ce.a,{fontSize:"large",color:"primary"})}),Object(B.jsx)(A.a,{className:r.buttonIcon,onClick:function(){u("VideoCall")},children:Object(B.jsx)(ke.a,{fontSize:"large",color:"primary"})})]})]})},Ee=n(24),Ae=n(363),Te=Object(d.a)((function(e){return{mediaContainer:{position:"relative",display:"flex",flexWrap:"wrap"},progressBarContainer:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",height:"100%",width:"100%",borderRadius:"10px",background:"#000000b1"}}}));function Re(e){var t=Object(a.useState)(0),n=Object(j.a)(t,2),r=n[0],c=n[1];return Object(a.useEffect)((function(){function t(t){e.msgtempid===t.detail.msgTempId&&c(t.detail.amount)}return document.addEventListener("uploadProgress",t),function(){document.removeEventListener("uploadProgress",t)}}),[e.msgtempid]),Object(B.jsxs)(m.a,{position:"relative",display:"inline-flex",children:[Object(B.jsx)(R.a,Object(C.a)({value:r,variant:"determinate"},e)),Object(B.jsx)(m.a,{top:0,left:0,bottom:0,right:0,position:"absolute",display:"flex",alignItems:"center",justifyContent:"center",children:Object(B.jsx)(O.a,{variant:"caption",component:"div",style:{color:"white",fontSize:"1.3em"},children:"".concat(r,"%")})})]})}function Le(e){var t=e.image,n=t.secure_url||URL.createObjectURL(t);return Object(a.useEffect)((function(){return function(){URL.revokeObjectURL(n)}}),[n]),Object(B.jsx)("img",{style:{objectFit:"cover",margin:"0.3em",width:"calc(100%/3 - 10px)",flexGrow:"1",maxHeight:"100px",borderRadius:"10px"},src:n,alt:"msg-media"})}function Fe(e){var t=e.video,n=t.secure_url||URL.createObjectURL(t);return Object(a.useEffect)((function(){return function(){URL.revokeObjectURL(n)}}),[n]),Object(B.jsx)("video",{style:{margin:"0.3em",width:"calc(100%/3 - 10px)",flexGrow:"1",maxHeight:"20vw",borderRadius:"10px"},src:n,controls:!0})}function Pe(e){var t=e.file,n=Object(q.a)(),r=Object(d.a)((function(e){return{fileContainer:{display:"flex",alignItems:"center"},fileName:{maxWidth:"25vw",color:e.palette.background.default},fileIcon:{}}}))(),c=t.name,i=t.secure_url||URL.createObjectURL(t);return Object(a.useEffect)((function(){return function(){URL.revokeObjectURL(i)}}),[i]),Object(B.jsxs)("div",{className:r.fileContainer,children:[Object(B.jsx)(Ae.a,{className:r.fileIcon,htmlColor:n.palette.background.paper}),Object(B.jsx)(O.a,{className:r.fileName,variant:"body1",noWrap:!0,component:"a",href:i,download:c,children:c})]})}var Be=function(e){var t=e.media,n=e.isUploading,a=e.msgTempId,r=Te();return Object(B.jsxs)(m.a,{className:r.mediaContainer,children:[n&&Object(B.jsx)("div",{className:r.progressBarContainer,children:Object(B.jsx)(Re,{size:"5em",msgtempid:a})}),t.images.map((function(e,t){return Object(B.jsx)(Le,{className:r.image,image:e,alt:"msg-media"},t)})),t.videos.map((function(e,t){return Object(B.jsx)(Fe,{video:e},t)})),t.files.map((function(e,t){return Object(B.jsx)(Pe,{file:e,className:r.fileContainer},t)}))]})},Me=Object(d.a)((function(e){return{avatar:{height:"2em",width:"2em"},timestamp:{marginTop:"4em"}}}));var Ue=function(e){var t=e.prevMsgTimestamp,n=e.msg,r=e.otherEndUser,c=Object(q.a)(),i=Me(),s=Object(a.useState)(n),o=Object(j.a)(s,2),l=o[0],u=o[1];Object(a.useEffect)((function(){n.mediaMessageResponse&&n.mediaMessageResponse.then((function(e){u(e.data)}))}),[n]);var d=n.from===r.username?"from":"to";function b(){var e=864e4,a=18e5,r=Oe()(n.timestamp).diff(Oe()(t)),c=Oe()().diff(Oe()(n.timestamp));switch(!0){case r<a:return!1;case c<a:return Oe()(n.timestamp).fromNow();case c<e:return Oe()(n.timestamp).format("hh:mm A");case c<7*e:return"".concat(Oe()(n.timestamp).format("ddd")," at ").concat(Oe()(n.timestamp).format("hh:mm A"));case c<365*e:return"".concat(Oe()(n.timestamp).format("MMM D")," at ").concat(Oe()(n.timestamp).format("hh:mm A"));default:return"".concat(Oe()(n.timestamp).format("D MMM, YYYY")," at ").concat(Oe()(n.timestamp).format("hh:mm A"))}}function f(e){return"to"===e?{background:c.palette.primary.main,text:c.palette.getContrastText(c.palette.primary.main)}:c.palette.background.paper}return Object(B.jsxs)(m.a,{my:"1em",children:[b()?Object(B.jsx)(O.a,{className:i.timestamp,variant:"subtitle1",color:"textSecondary",align:"center",children:b()}):null,Object(B.jsxs)(m.a,{display:"flex",justifyContent:"to"===d?"flex-end":"flex-start",mx:"1em",my:"0.5em",alignItems:"baseline",children:["from"===d&&Object(B.jsx)(be.a,{className:i.avatar,alt:r.username.toUpperCase(),src:r.profilePic}),Object(B.jsxs)(m.a,{maxWidth:"60%",borderRadius:function(e){return"to"===e?"20px 0px 20px 20px":"0px 20px 20px 20px"}(d),boxShadow:"rgb(145 158 171 / 24%) 0px 8px 16px 0px",bgcolor:f(d).background,mx:"from"===d?"1em":0,p:"1em",children:[Object(B.jsx)(O.a,{component:"p",variant:"body1",style:{fontSize:"1.1rem",wordBreak:"break-word",overflowWrap:"break-word",wordWrap:"break-word",color:"to"===d?f(d).text:c.palette.text.primary},children:n.text}),(l.media.images.length>0||l.media.videos.length>0||l.media.files.length>0)&&Object(B.jsx)(Be,{media:l.media,isUploading:!!l.mediaMessageResponse,msgTempId:l.msgTempId})]})]})]})},ze=n(9),Ge=n(45),We=n(364),De=n(365),He=n(366),Ye=n(367),qe=n(395),Ve=Object(a.createContext)({}),Ke=Object(d.a)({root:{width:"60%",minWidth:"300px",marginTop:"auto",borderRadius:"20px",margin:"1.5em auto",padding:"1em",boxShadow:"rgb(145 158 171 / 24%) 0px 8px 16px 0px"},form:{display:"flex",alignItems:"center"},selectedItemsContainer:{padding:"0.5em",maxHeight:"25vh",overflowY:"scroll"},selectedMediasContainer:{display:"flex",flexWrap:"wrap"}});function Ze(e){var t,n=[],a=[],r=Object(Ge.a)(e);try{for(r.s();!(t=r.n()).done;){var c=t.value,i=c.type.split("/")[0];"image"===i&&n.push(c),"video"===i&&a.push(c)}}catch(s){r.e(s)}finally{r.f()}return 0===n.length&&0===a.length?[null,null]:[n,a]}var Xe=function e(t){var n=t.from,a=void 0===n?"":n,r=t.recipient,c=t.images,i=void 0===c?[]:c,s=t.videos,o=void 0===s?[]:s,l=t.links,u=void 0===l?[]:l,d=t.files,m=void 0===d?[]:d,j=t.text,b=void 0===j?"":j;Object(ze.a)(this,e),this.tempMsgId=Object(qe.a)(),this.from=a,this.recipient=r,this.media={images:i,videos:o,links:u,files:m},this.text=b,this.timestamp=new Date};var Je=Object(d.a)({previewContainer:{position:"relative",width:"40px",height:"40px",marginRight:"0.8em",marginBottom:"0.8em"},selectedImage:{width:"100%",height:"100%",objectFit:"cover",borderRadius:"20%"},removeBtn:{all:"unset",position:"absolute",top:"-6px",right:"-6px",display:"flex",alignItems:"center",justifyContent:"center",height:"18px",width:"18px",textAlign:"center",fontSize:"12px",fontWeight:"bold",backgroundColor:"#00000088",borderRadius:"50%",zIndex:"100","&:hover":{transform:"scale(1.1)"},"&:active":{transform:"scale(1)"}},videoContainer:{position:"relative",width:"40px",height:"40px",marginRight:"0.8em",marginBottom:"0.8em","&>video":{height:"100%",width:"100%",objectFit:"cover",borderRadius:"20%"},"&::before":{content:"''",backgroundImage:"url(".concat("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGAAAABgCAYAAADimHc4AAAABmJLR0QA/wD/AP+gvaeTAAAHoUlEQVR4nO2dW4xdVRnH/2skUqcQabEFowhPdkJbQoPBkEClBcKDVowXTOQSIEZBNKEIpA8khHh5IUUsvKgohiY8SAKijwZ9KJeAEBrolIF0QJpKBMrMYKdeiszPh3WOrYdyvm+fvdZeu7B/yWQe1sn3/ddae6/7+rbU0dHR0dHR0dHR0fFBI5QWMAxguaQ1klYc8rdc0mJJS3r/JWm/pNne/9ckvShpStILkp4JIbzRrHI/raoAYFzSBZLWS1onaZXqa0TSDkl/7P39IYTwz5o23z8AY8DZwM+At8jPP4DfABuAD5XOfzGARcB3gJcaKPT3Yhq4BlhUujwaAxgHbgBeLVjwg7wKfJ/YBL5/Ib72L5ct66HsAb5WupySA5wC/L5w4VbhIeDk0uWWBOBLwEzhAh2Ft4Cv5y6fbMNQ4GhJmyVdW9PU65K2KQ4lpxTH+LOS5iTN935zjKTjFOcGKyRNSFopaa2kZTX93ynpxhDCv2vaaQ7geODxGk/fn4GNwCpg5IcECMBq4Hrg6Rp6HgWWpiyjbAAnATtHyOTfgc3AqRm1rQRuB/aNoG8SOCmXtiQAE8DuihmbAW6hwSeM+IbeCsxW1LobmGhKZyWATwB/qZCZBeBe4npPKc1LiTPwhQq699C2ERLxiarS7OwCzi6tuw+wlmoz8kna0icAR1Otw70f+Ghp3YMAxwEPVMjHY8SRXnHhdzkFLwA3lNY7DOKoaRP+JmlLacFfdQp9G7iqqNgKAJcCB5x5+0opkacAcw6BB4ANRUTWAPhi78GxmKVEpwz8ziFuAbiicXGJAC7B1xw91LSwixyioOVtvgdin+ChmbecuJ7vGe/f34igzBA75gcd+X0J+EgTgm50iNlFC4eao0IconrmCRtzC1mEvZO1QMJJFnAPsNj+ZV6Ac7H7g7+Sc25A3MO1+GVinwDPA6tT2h1Ry1ZH/q/O5XwM+zWcAequvw/67TNP4REVcAL20HuaGkvow5yvc9T+LRn8DnIvBZsk4IeOcvhcDse/MpzOAx/L4PdwFGuSiAuP1n7C3amdjhM3TIaxOanTg76HVXiRJgn4iVEWc6QckuKbeGXZyXL4bXyURNzmtPiCx9aY0+d6I/2pEMJOp63UXCHpKRpskkIIz0nabvxsnceWtwIsY/c57eRiQtLjNNskWXk+L4kXYDn2BGRVEmeH91+VRpok4HRDxzukGJQAFxqOXiPHuPeg/1HIPkoirhG9Yeg437LjaYJWGOnbQgj4ZDdG9iapl+dtDh1DSVEBOxw2SrBY0j3knbhNGumftgx4KsAy8oLDRkkuk/QkeYbJU0a69fC6KuBEI/1Fh43SnKpYCambJCvvVtm5KuBYI32vw0YbyNEkWXm3yi5JBexz2GgTlyndxM3Ke5IKOMZInzfS28iEpCeAb9W000gFdGTEUwHWE269IW1kStJnQwg/r2mndvPsqYDar1nL2CrpM70Ftbq0ogKSb8JkYr+kK0MIl4cQ9ieyaeU9SQX8zUg3Z3stYKekM0MIv05s18q7VXauCrAmG+ZsrzBbFQs/x36FtdZjrhIc5XBiTbezLUXXZL+k72Z46g9lpZGepAKsN2AtEFq2Ijol6eJEHe1hAcYknWP8rP46GbAMe0Mm29r7CHsBTW3IrDF0vAMcb9kx+4BesCPrSbrAKzwj/VHOlQlHOcOw8vxsCOFNy4h3JvwnI/0bTju5mJJ0Vub2fpBLjPSHk3ki3haxyNIZt6XJGdB0mkPX51M6HMeOZnV7Mof/7/u9KHkw6w6jLOZIHQSK7mhiX4/naOIvcjj2HM69NYPfQUofzv2xoxzW5nA8Rjx6PYxZEoceOMR2G46nfxz7jOwuch3TwXdBI+lIpGezLRc07nPk/9s5BXivKCV7BWnPFaX1jsLfQ+7wBcToghav0JZgFgkAluALNnhdE2LGnWIeIOORxaYgHkH0XEqfpolrqj1RnokZwKZGBGUEuNmZ13QTL6cwb6iCIyZIxyDEoB2eUAUPlhB3Mr6QX28DFzUusCbEcJueYB0zwKdKidzgfEL+A3yziMgRAC7HF65mAfhyabFbHEL7YjfR4o6Z2OHe7HyoAO4orbkfsuxRp2CIgS+WlNY9CDGAn6df6/MI8OHSuiX9T/xkBfEvk+My84gQJ1mvVNC/g7bNc6gethJiQO9PFtR8InFxr2rYyjKdrgWjBW6dA35AhqXsITqXAT/CXlgbZDfQ7mM4xNDFVZqjPvuIN9BzbvCfRtxMmR9B3w4Kvq2VIPYJj42QyT7PEANDnU48/jGqjjHi6YWbgO019DxCpjY/d/j62yR9r6apvYq3ESclPa94TmlGhw9fv1TvDl9vHg0ZApK2SLophHCghp1yEONMHKkfcLi4dPklgbhsUWWMXZrf0taRTh2ISxclP1tlMU3Tq5pNQ9xP2EgMcNcW9gDX0dR6fhsgLmFcg73Rn5Np4GraEAW9JMAZwE+BvQ0U+hxx9ns+LVgYLC7gUIhNwHmKAaLWS1qt+jc5FyQ9q4Mf83w4hPCvmjaT0aoKGIS4PLFG8SrQhA5+zvZYxXF//4bmvOK8YJ/e/Tnb7SGEI+U2f0dHR0dHR0dHR0fHB4D/AqDS4SxfDHKpAAAAAElFTkSuQmCC",")"),backgroundPosition:"center",backgroundSize:"contain",height:"100%",width:"100%",position:"absolute",zIndex:"50"}}});function Qe(e){var t=e.media,n=e.removeSelectedMedia,a=e.index,r=Je(),c=URL.createObjectURL(t);return Object(B.jsxs)("div",{className:r.previewContainer,children:[Object(B.jsx)("button",{className:r.removeBtn,onClick:function(){URL.revokeObjectURL(c),n(a)},children:Object(B.jsx)(Ye.a,{htmlColor:"white",fontSize:"inherit"})}),"image"===t.type.split("/")[0]?Object(B.jsx)("img",{className:r.selectedImage,src:c,alt:"img"}):Object(B.jsx)("div",{className:r.videoContainer,children:Object(B.jsx)("video",{src:c})})]})}var _e=Object(d.a)({selectedFilePreviewContainer:{display:"flex",alignItems:"center",padding:"1em"},fileIcon:{marginRight:"0.3em"},fileName:{width:"20vw"},removeBtn:{all:"unset",display:"flex",alignItems:"center",justifyContent:"center",height:"18px",width:"18px",margin:"auto 0.5em",textAlign:"center",fontSize:"12px",fontWeight:"bold",backgroundColor:"#00000088",borderRadius:"50%","&:hover":{transform:"scale(1.1)"},"&:active":{transform:"scale(1)"}}});function $e(e){var t=e.file,n=e.removeSelectedFile,a=e.index,r=Object(q.a)(),c=_e();return Object(B.jsxs)("div",{className:c.selectedFilePreviewContainer,children:[Object(B.jsx)(Ae.a,{className:c.fileIcon,htmlColor:r.palette.primary.main}),Object(B.jsx)(O.a,{className:c.fileName,variant:"body1",noWrap:!0,children:t.name}),Object(B.jsx)("button",{className:c.removeBtn,onClick:function(){n(a)},children:Object(B.jsx)(Ye.a,{htmlColor:"white",fontSize:"inherit"})})]})}var et=function(e){var t=e.updateMessages,n=Ke(),r=Object(a.useContext)(xe),c=Object(a.useContext)(Ve),i=Object(u.i)().username,s=Object(a.useState)(""),o=Object(j.a)(s,2),l=o[0],d=o[1],b=Object(a.useState)([]),h=Object(j.a)(b,2),x=h[0],g=h[1],v=Object(a.useState)([]),y=Object(j.a)(v,2),w=y[0],C=y[1],k=Object(a.useState)([]),N=Object(j.a)(k,2),E=N[0],T=N[1],R=Object(a.useState)(!1),L=Object(j.a)(R,2),F=L[0],P=L[1],M=Object(a.useState)(""),U=Object(j.a)(M,2),z=U[0],G=U[1];function W(e){var t=new CustomEvent("sendMessage",{detail:e});document.dispatchEvent(t)}function D(e){var t=new CustomEvent("uploadProgress",{detail:e});document.dispatchEvent(t)}function H(){return(H=Object(p.a)(f.a.mark((function e(n){var a,s,o,u,m;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),l||x.length>0||w.length>0||E.length>0){e.next=3;break}return e.abrupt("return");case 3:x.length||w.length||E.length?(a=new Xe({from:c.username,recipient:i,images:x,videos:w,links:[],files:E,text:l}),(s=new FormData).append("recipient",i),s.append("text",l),x.forEach((function(e){return s.append("images",e)})),w.forEach((function(e){return s.append("videos",e)})),E.forEach((function(e){return s.append("files",e)})),o={onUploadProgress:function(e){D({amount:Math.round(100*e.loaded/e.total),tempMsgId:a.tempMsgId})}},(u=S.post("/sendMediaMessage",s,o)).then((function(e){var t=e.data._id,n=e.data.recipientId;r.emit("gotMediaMessaageResponse",t,n)})),a.mediaMessageResponse=u,W(a),t(a,i),d(""),G(!1),g([]),C([]),T([])):(m=new Xe({recipient:i,text:l}),d(""),G(!1),t(m,i),r.emit("send-message",m),W(m));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(){return(Y=Object(p.a)(f.a.mark((function e(t){var n,a,r,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Ze(t.target.files),a=Object(j.a)(n,2),r=a[0],c=a[1],r||c?(g(r),C(c)):P(!0),t.target.value="";case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){g((function(t){return t.splice(e,1),Object(Ee.a)(t)}))}function V(e){C((function(t){return t.splice(e,1),Object(Ee.a)(t)}))}function K(e){T((function(t){return t.splice(e,1),Object(Ee.a)(t)}))}return Object(a.useEffect)((function(){z?r.emit("typing",i,"start"):r.emit("typing",i,"stop")}),[z,i,r]),Object(a.useEffect)((function(){d("")}),[i]),Object(B.jsxs)(m.a,{className:n.root,children:[F&&Object(B.jsx)(O.a,{variant:"body2",color:"error",align:"center",children:"Invalid file selected!"}),Object(B.jsxs)(m.a,{className:n.selectedItemsContainer,children:[(x.length>0||w.length>0)&&Object(B.jsxs)(m.a,{className:n.selectedMediasContainer,children:[x.map((function(e,t){return Object(B.jsx)(Qe,{media:e,removeSelectedMedia:q,index:t},t)})),w.map((function(e,t){return Object(B.jsx)(Qe,{media:e,removeSelectedMedia:V,index:t},t)}))]}),E.length>0&&Object(B.jsx)(m.a,{children:E.map((function(e,t){return Object(B.jsx)($e,{file:e,removeSelectedFile:K,index:t},t)}))})]}),Object(B.jsxs)("form",{className:n.form,onSubmit:function(e){return H.apply(this,arguments)},children:[Object(B.jsx)("input",{accept:"image/*,video/*",style:{display:"none"},id:"image-btn",type:"file",multiple:!0,onChange:function(e){return Y.apply(this,arguments)}}),Object(B.jsx)(A.a,{variant:"contained",component:"label",htmlFor:"image-btn",color:"primary",children:Object(B.jsx)(We.a,{color:"primary"})}),Object(B.jsx)("input",{accept:".pdf,.txt,.zip,.docx,.xml",style:{display:"none"},id:"attachment-btn",type:"file",multiple:!0,onChange:function(e){T(Object(Ee.a)(e.target.files)),e.target.value=""}}),Object(B.jsx)(A.a,{variant:"contained",component:"label",htmlFor:"attachment-btn",color:"primary",children:Object(B.jsx)(De.a,{color:"primary"})}),Object(B.jsx)(I.a,{fullWidth:!0,placeholder:"Type something to send...",autoFocus:!0,"aria-label":"message input box",value:l,onChange:function(e){e.target.value?G(!0):G(!1),d(e.target.value)}}),Object(B.jsx)(A.a,{type:"submit",children:Object(B.jsx)(He.a,{color:"primary"})})]})]})},tt=Object(d.a)({container:{display:"flex",width:"fit-content",margin:"1em",padding:"0.5em",borderRadius:"10px 10px 10px 0"},dot:{height:"0.4em",width:"0.4em",margin:"0.2em",borderRadius:"50%",backgroundColor:"#00000055","&:nth-child(1)":{animation:"$typing 600ms 200ms ease alternate backwards infinite"},"&:nth-child(2)":{animation:"$typing 600ms 400ms ease alternate backwards infinite"},"&:nth-child(3)":{animation:"$typing 600ms 600ms ease alternate backwards infinite"}},"@keyframes typing":{from:{opacity:"0.3",transform:"translateY(-50%) scale(1.1)"},to:{opacity:"1"}}});var nt=function(){var e=tt();return Object(B.jsxs)(m.a,{className:e.container,boxShadow:5,children:[Object(B.jsx)("div",{className:e.dot}),Object(B.jsx)("div",{className:e.dot}),Object(B.jsx)("div",{className:e.dot})]})};var at=function(e){var t=e.otherEndUser,n=Object(a.useRef)(),r=Object(a.useContext)(xe),c=Object(a.useState)([]),i=Object(j.a)(c,2),s=i[0],o=i[1],l=Object(a.useState)({state:"",user:""}),u=Object(j.a)(l,2),d=u[0],b=u[1];function h(e,t){e.from!==t&&e.recipient!==t||o((function(t){return[].concat(Object(Ee.a)(t),[e])}))}function O(){return(O=Object(p.a)(f.a.mark((function e(t){var n,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,S.get("/messages/".concat(t));case 4:n=e.sent,(a=n.data.messages)&&o((function(e){return[].concat(Object(Ee.a)(e),Object(Ee.a)(a))}));case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){function e(e){h(e,t.username)}return r.on("receive-message",e),function(){r.off("receive-message",e)}}),[r,t]),Object(a.useEffect)((function(){n.current.scrollTo(0,n.current.scrollHeight)}),[s,d]),Object(a.useEffect)((function(){return t&&function(e){O.apply(this,arguments)}(t.username),r.on("typing",(function(e,n){n===t.username&&b({state:e,user:n})})),function(){r.removeAllListeners("typing"),o([])}}),[t,r]),Object(B.jsxs)(B.Fragment,{children:[Object(B.jsxs)(m.a,{ref:n,style:{marginTop:"5em",overflowY:"scroll"},children:[s.map((function(e,n){var a;return Object(B.jsx)(Ue,{msg:e,prevMsgTimestamp:(null===(a=s[n-1])||void 0===a?void 0:a.timestamp)||0,otherEndUser:t},e._id||e.tempMsgId)})),"start"===d.state&&d.user===t.username?Object(B.jsx)(nt,{}):null]}),Object(B.jsx)(et,{updateMessages:h})]})};var rt=function(){var e=Object(q.a)(),t=Object(u.i)().username,n=Object(a.useState)({}),r=Object(j.a)(n,2),c=r[0],i=r[1];return Object(a.useEffect)((function(){t&&Object(p.a)(f.a.mark((function e(){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get("userinfo/".concat(t));case 2:n=e.sent,i(n.data);case 4:case"end":return e.stop()}}),e)})))()}),[t]),t?Object(B.jsxs)(m.a,{width:1,style:{height:"100vh"},display:"flex",flexDirection:"column",position:"relative",bgcolor:e.palette.background.default,children:[Object(B.jsx)(Ie,{userInfo:c}),Object(B.jsx)(at,{otherEndUser:c})]}):Object(B.jsx)(m.a,{display:"flex",flexGrow:"1",justifyContent:"center",alignItems:"center",children:Object(B.jsx)(O.a,{variant:"h6",align:"center",color:"textSecondary",children:"Open Chat To Start Messenging."})})},ct=n(94),it=n(368),st=Object(d.a)({logoutText:{fontSize:"0.9rem",fontWeight:"bold"}});var ot=function(){var e=st(),t=Object(a.useState)(!0),n=Object(j.a)(t,2),r=n[0],c=n[1],i=Object(a.useState)(!1),s=Object(j.a)(i,2),o=s[0],l=s[1];function d(){return(d=Object(p.a)(f.a.mark((function e(t){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l(!0),e.next=4,S.delete("/logout",{headers:{LogoutType:t}});case 4:200===e.sent.status&&(window.localStorage.clear(),console.log("cleared the localStorage"),c(!1)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),l(!1);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}return r?Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)(m.a,{display:"flex",alignItems:"center",children:[Object(B.jsx)(O.a,{className:e.logoutText,color:"textSecondary",children:"Logout"}),Object(B.jsx)(A.a,{onClick:function(e){return d.apply(this,arguments)},size:"small","aria-label":"logout",children:o?Object(B.jsx)(R.a,{size:"1em"}):Object(B.jsx)(it.a,{})})]})}):Object(B.jsx)(u.a,{to:{pathname:"/login",state:{alert:{type:"success",message:"Succesfully LoggedOut!"}}}})},lt=Object(d.a)({username:{fontWeight:"bolder",marginLeft:"0.5em"},userAvatar:{"&:hover":{cursor:"pointer"}}});var ut=function(e){var t=e.setShowChangeProfilePicture,n=lt(),r=Object(a.useContext)(Ve).LoggedInUser;return Object(B.jsxs)(m.a,{display:"flex",alignItems:"center",children:[Object(B.jsx)(be.a,{onClick:function(){t(!0)},className:n.userAvatar,alt:r.username,src:r.profilePic}),Object(B.jsxs)(O.a,{className:n.username,variant:"h6",color:"textPrimary",children:[r.firstName," ",r.lastName]})]})},dt=n(393),mt=n(374),jt=n(375),bt=n(376),ft=n(377),pt=n(396),ht=n(107),Ot=n(369),xt=n(370),gt=n(371),vt=n(123),yt=Object(d.a)({button:{display:"flex",padding:"1em",alignItems:"center"}}),wt=Object(N.a)((function(e){return{buttonRipple:{color:e.palette.primary.main},main:{padding:"0.5em",width:"100%",justifyContent:"start","&:hover":{transform:"scale(1.01)",boxShadow:"rgb(145 158 171 / 24%) 0px 5px 16px 0px"}}}}))((function(e){return Object(B.jsx)(pe.a,{onClick:e.onClick,className:e.classes.main,TouchRippleProps:{classes:{root:e.classes.buttonRipple}},component:"div",children:e.children})}));function St(e){var t=e.person,n=Object(vt.a)(),a="";switch(!0){case 0===t.mutualFriends.length:return null;case 1===t.mutualFriends.length:a="".concat(t.mutualFriends[0]," is mutual");break;case 2===t.mutualFriends.length:a="".concat(t.mutualFriends[0]," and ").concat(t.mutualFriends[1]," are mutual");break;default:a="".concat(t.mutualFriends.length," mutual friends including ").concat(t.mutualFriends[0]," and ").concat(t.mutualFriends[1])}return Object(B.jsx)(O.a,{variant:"body2",style:{color:n.palette.grey[700]},children:a})}var Ct=function(e){var t=e.person,n=e.type,c=e.update,i=Object(u.g)(),s=yt(),o=Object(a.useContext)(xe),l=Object(a.useState)(t.online),d=Object(j.a)(l,2),b=d[0],h=d[1],x=Object(a.useState)(!1),g=Object(j.a)(x,2),v=g[0],y=g[1];function w(e){return C.apply(this,arguments)}function C(){return(C=Object(p.a)(f.a.mark((function e(n){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,setTimeout((function(){y(!0)}),0),e.next=4,S.post("/friendrequest",{username:t.username,type:n});case 4:e.t0=n,e.next="send"===e.t0?7:"accept"===e.t0?9:"reject"===e.t0?11:"cancel"===e.t0?13:"unfriend"===e.t0?15:17;break;case 7:return t.isRequestPending=!0,e.abrupt("break",18);case 9:return t.isFriend=!0,e.abrupt("break",18);case 11:return t.hasSentFriendRequest=!1,e.abrupt("break",18);case 13:return t.isRequestPending=!1,e.abrupt("break",18);case 15:return t.isFriend=!1,e.abrupt("break",18);case 17:return e.abrupt("break",18);case 18:y(!1),c(),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(0),console.log(e.t1);case 25:case"end":return e.stop()}}),e,null,[[0,22]])})))).apply(this,arguments)}function k(e){var t=e.unFriend,n=Object(vt.a)(),a=r.a.useState(null),c=Object(j.a)(a,2),i=c[0],s=c[1],o=Boolean(i),l=o?"unfriend":void 0;return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(T.a,{"aria-describedby":l,variant:"outlined",color:"primary",onClick:function(e){s(e.currentTarget)},style:{marginLeft:"auto",textTransform:"capitalize"},children:"Friends"}),Object(B.jsx)(pt.a,{id:l,open:o,anchorEl:i,onClose:function(){s(null)},anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},children:Object(B.jsx)(T.a,{variant:"outlined",onClick:t,style:{marginLeft:"auto",textTransform:"capitalize",color:n.palette.grey[700]},children:"Unfriend"})})]})}function N(){return Object(B.jsx)(T.a,{variant:"outlined",color:"primary",style:{marginLeft:"auto"},children:Object(B.jsx)(R.a,{size:20})})}return Object(a.useEffect)((function(){function e(e,n){e===(null===t||void 0===t?void 0:t.username)&&h(n)}return o.on("onlineStateChange",e),function(){o.off("onlineStateChange",e)}}),[o,t]),Object(B.jsxs)(wt,{onClick:function(){if("friend"===n)return i.push("/messenger/".concat(t.username))},className:s.button,component:"div",children:[Object(B.jsx)(ge,{variant:"dot",overlap:"circle",anchorOrigin:{vertical:"bottom",horizontal:"right"},badgeContent:" ",isonline:b?1:0,children:Object(B.jsx)(be.a,{alt:t.firstName,src:t.profilePic})}),Object(B.jsxs)(m.a,{ml:2,children:[Object(B.jsxs)(O.a,{variant:"h6",style:{fontSize:"1rem"},color:"textPrimary",children:[t.firstName," ",t.lastName]}),n?Object(B.jsx)(St,{person:t}):null]}),v?Object(B.jsx)(N,{}):function(e){switch(e){case"friendRequest":return Object(B.jsxs)(m.a,{ml:"auto",display:"flex",children:[Object(B.jsx)(A.a,{onClick:function(){return w("accept")},children:Object(B.jsx)(Ot.a,{htmlColor:ht.a[600]})}),Object(B.jsx)(A.a,{onClick:function(){return w("reject")},children:Object(B.jsx)(xt.a,{color:"error"})})]});case"unknown":return Object(B.jsx)(A.a,{onClick:function(){return w("send")},style:{marginLeft:"auto"},children:Object(B.jsx)(gt.a,{})});case"pendingRequest":return Object(B.jsx)(T.a,{variant:"outlined",color:"primary",onClick:function(){return w("cancel")},style:{marginLeft:"auto",textTransform:"capitalize"},children:"Cancel"});case"friend":return Object(B.jsx)(k,{unFriend:function(){return w("unfriend")}});default:return null}}(n)]})};var kt=function(){var e=Object(a.useState)([]),t=Object(j.a)(e,2),n=t[0],r=t[1],c=Object(a.useState)(!0),i=Object(j.a)(c,2),s=i[0],o=i[1];function l(){return u.apply(this,arguments)}function u(){return(u=Object(p.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get("/friendlist");case 2:t=e.sent,r(t.data),o(!1);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return Object(a.useEffect)((function(){l()}),[]),Object(B.jsxs)("div",{style:{width:"100%",overflowY:"scroll",overflowX:"hidden"},children:[!s&&0===n.length&&Object(B.jsx)(m.a,{p:5,children:Object(B.jsx)(O.a,{variant:"body1",align:"center",color:"textSecondary",children:"You Have No Friends. Make Some to Start Messenging."})}),!s&&0!==n.length&&n.map((function(e){return Object(B.jsx)(Ct,{person:e,type:"friend",update:l},e._id)}))]})};var Nt=function(e){var t=e.update,n=e.changed,r=Object(a.useState)([]),c=Object(j.a)(r,2),i=c[0],s=c[1],o=Object(a.useState)(!0),l=Object(j.a)(o,2),u=l[0],d=l[1];return Object(a.useEffect)((function(){Object(p.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get("/friendRequest");case 2:t=e.sent,s(t.data),d(!1);case 5:case"end":return e.stop()}}),e)})))()}),[n]),Object(B.jsxs)(m.a,{my:"1em",children:[Object(B.jsxs)(O.a,{variant:"h6",align:"center",color:"primary",children:[Object(B.jsx)(gt.a,{style:{marginRight:"0.5em"}}),"Friend Requests"]}),!u&&0===i.length&&Object(B.jsx)(m.a,{px:5,children:Object(B.jsx)(O.a,{variant:"body1",align:"center",color:"textSecondary",children:"When you have friend requests or suggestions, you'll see them here."})}),!u&&0!==i.length&&i.map((function(e){return Object(B.jsx)(Ct,{person:e,type:"friendRequest",update:t},e._id)}))]})},It=n(372);var Et=function(e){var t=e.update,n=e.changed,r=Object(a.useState)([]),c=Object(j.a)(r,2),i=c[0],s=c[1],o=Object(a.useState)(!0),l=Object(j.a)(o,2),u=l[0],d=l[1];return Object(a.useEffect)((function(){Object(p.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get("/friendRequest/pending");case 2:t=e.sent,s(t.data),d(!1);case 5:case"end":return e.stop()}}),e)})))()}),[n]),Object(B.jsxs)(m.a,{my:"1em",children:[Object(B.jsxs)(O.a,{variant:"h6",align:"center",color:"primary",children:[Object(B.jsx)(It.a,{}),"Pending Friend Requests"]}),!u&&0===i.length&&Object(B.jsx)(m.a,{px:5,children:Object(B.jsx)(O.a,{variant:"body1",align:"center",color:"textSecondary",children:"When you have pending friend requests, you'll see them here."})}),!u&&0!==i.length&&i.map((function(e){return Object(B.jsx)(Ct,{person:e,type:"pendingRequest",update:t},e._id)}))]})},At=n(373);var Tt=function(e){var t=e.update,n=e.changed,r=Object(a.useState)([]),c=Object(j.a)(r,2),i=c[0],s=c[1],o=Object(a.useState)(!0),l=Object(j.a)(o,2),u=l[0],d=l[1];return Object(a.useEffect)((function(){Object(p.a)(f.a.mark((function e(){var t;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get("/peopleyoumayknow");case 2:t=e.sent,s(t.data),d(!1);case 5:case"end":return e.stop()}}),e)})))()}),[n]),Object(B.jsxs)(m.a,{mt:"1em",children:[Object(B.jsxs)(O.a,{variant:"h6",align:"center",color:"primary",children:[Object(B.jsx)(At.a,{}),"People You May Know"]}),!u&&0===i.length&&Object(B.jsx)(m.a,{px:5,children:Object(B.jsx)(O.a,{variant:"body1",align:"center",color:"textSecondary",children:"When you have friend's suggestions, you'll see them here."})}),!u&&0!==i.length&&i.map((function(e){return Object(B.jsx)(Ct,{person:e,type:"unknown",update:t},e._id)}))]})};var Rt=function(){var e=Object(a.useState)(),t=Object(j.a)(e,2),n=t[0],r=t[1];function c(){r(Math.random())}return Object(B.jsxs)("div",{style:{width:"100%",overflowY:"scroll",overflowX:"hidden"},children:[Object(B.jsx)(Nt,{changed:n,update:c}),Object(B.jsx)(L.a,{variant:"middle"}),Object(B.jsx)(Et,{changed:n,update:c}),Object(B.jsx)(L.a,{variant:"middle"}),Object(B.jsx)(Tt,{changed:n,update:c})]})};function Lt(e){return Ft.apply(this,arguments)}function Ft(){return(Ft=Object(p.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,S.get("/conversations",{cancelToken:null===t||void 0===t?void 0:t.token});case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pt=function(){var e=Object(a.useContext)(xe),t=Object(a.useState)([]),n=Object(j.a)(t,2),r=n[0],c=n[1];function i(e){var t=e.detail?e.detail:e;c((function(e){if(0===e.length)return Lt().then((function(e){c(e)})),[];var n=e.findIndex((function(e){return(null===e||void 0===e?void 0:e.with)===t.recipient})),a=e.splice(n,1)[0];return e.splice(0,0,a),Object(Ee.a)(e)}))}return Object(a.useEffect)((function(){var t,n=g.a.CancelToken.source();return Lt(n).then((function(e){c(e)})),t=i,document.addEventListener("sendMessage",t),e.on("receive-message",i),function(){n.cancel(),function(e){document.removeEventListener("sendMessage",e)}(i),e.off("receive-message",i)}}),[e]),Object(B.jsx)("div",{style:{width:"100%",height:"100%",marginTop:"0.5em",overflowY:"scroll",overflowX:"hidden"},children:r.map((function(e){return Object(B.jsx)(Se,{lastMessage:e.messages.length&&e.messages[e.messages.length-1],conversationWith:e.with},e._id)}))})},Bt=Object(d.a)({tab:{width:"".concat(1/3*100,"%"),"@media (min-width: 600px)":{minWidth:"60px"}}});function Mt(e){return e.components[e.index]}var Ut=function(){var e=Bt(),t=Object(a.useState)(0),n=Object(j.a)(t,2),r=n[0],c=n[1];return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(m.a,{mt:2,boxShadow:"rgb(145 158 171 / 24%) 0px 3px 8px 0px",children:Object(B.jsxs)(dt.a,{value:r,onChange:function(e,t){c(t)},variant:"fullWidth",indicatorColor:"primary",textColor:"primary","aria-label":"icon tabs example",children:[Object(B.jsx)(mt.a,{className:e.tab,icon:Object(B.jsx)(jt.a,{}),"aria-label":"phone"}),Object(B.jsx)(mt.a,{className:e.tab,icon:Object(B.jsx)(bt.a,{}),"aria-label":"favorite"}),Object(B.jsx)(mt.a,{className:e.tab,icon:Object(B.jsx)(ft.a,{}),"aria-label":"person"})]})}),Object(B.jsx)(Mt,{components:[Object(B.jsx)(Pt,{}),Object(B.jsx)(kt,{}),Object(B.jsx)(Rt,{})],index:r})]})},zt=Object(d.a)((function(e){return{searchResultsContainer:{display:"flex",flexDirection:"column",alignItems:"center",position:"absolute",overflowY:"scroll",maxHeight:"50vh",width:"calc(100% - 2em)",margin:"0 1em",left:"0",padding:"0.5em 0.2em 0.5em 0.5em",backgroundColor:e.palette.background.paper,borderRadius:"0 0 10px 10px",zIndex:"1000",boxShadow:"rgb(145 158 171 / 10%) 0px 2px 5px 3px"}}}));var Gt=function(e){var t=e.searchText,n=Object(q.a)(),r=zt(),c=Object(a.useState)([]),i=Object(j.a)(c,2),s=i[0],o=i[1],l=Object(a.useState)(!1),u=Object(j.a)(l,2),d=u[0],b=u[1],h=Object(a.useState)(),x=Object(j.a)(h,2),v=(x[0],x[1]),y=Object(a.useRef)();function w(){v(Math.random())}return Object(a.useEffect)((function(){var e=g.a.CancelToken.source();function n(){return(n=Object(p.a)(f.a.mark((function t(n){var a;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b(!0),t.next=3,S.get("/search?search_term=".concat(n),{cancelToken:e.token});case 3:return a=t.sent,b(!1),t.abrupt("return",a.data);case 6:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return t&&function(e){return n.apply(this,arguments)}(t).then((function(e){o(e)})),function(){e.cancel()}}),[t]),Object(B.jsxs)(m.a,{className:r.searchResultsContainer,ref:y,children:[d&&Object(B.jsx)(R.a,{style:{justifySelf:"center"},size:30}),t&&!s.length&&!d&&Object(B.jsx)(O.a,{style:{margin:"0.5em"},align:"center",color:"textSecondary",children:"No Results Found!"}),null===s||void 0===s?void 0:s.map((function(e){return e.isFriend?Object(B.jsx)(Ct,{person:e,type:"friend",update:w},e._id):null})),s.some((function(e){return!e.isFriend}))?Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(O.a,{variant:"body1",style:{fontWeight:"bold",margin:"0.4em 0",marginLeft:"0.8em",color:n.palette.primary.main},children:"More People"}),null===s||void 0===s?void 0:s.map((function(e){return e.isRequestPending?Object(B.jsx)(Ct,{type:"pendingRequest",person:e,update:w},e._id):e.hasSentFriendRequest?Object(B.jsx)(Ct,{type:"friendRequest",person:e,update:w},e._id):e.isFriend?null:Object(B.jsx)(Ct,{type:"unknown",person:e,update:w},e._id)}))]}):null]})},Wt=n(378),Dt=Object(d.a)((function(e){return{root:{margin:"1em"},searchForm:{display:"flex",paddingLeft:"1em",width:"100%"},searchInput:{color:e.palette.text.primary,fontSize:"1rem",background:"transparent",outline:"none",border:"none",width:"100%","&::placeholder":{color:e.palette.text.secondary,fontSize:"1rem"}}}}));var Ht=function(){var e=Dt(),t=Object(a.useState)(""),n=Object(j.a)(t,2),r=n[0],c=n[1],i=Object(a.useState)(!1),s=Object(j.a)(i,2),o=s[0],l=s[1],u=Object(a.useRef)();function d(e){u.current.contains(e.target)||l(!1)}return Object(a.useEffect)((function(){l(!!r)}),[r]),Object(a.useEffect)((function(){return document.addEventListener("click",d),function(){document.removeEventListener("click",d)}}),[]),Object(B.jsx)(B.Fragment,{children:Object(B.jsxs)(m.a,{className:e.root,borderRadius:"5px",boxShadow:"rgb(145 158 171 / 10%) 0px 2px 5px 3px",tabIndex:"-1",onFocus:function(){r&&!o&&l(!0)},ref:u,children:[Object(B.jsxs)("form",{className:e.searchForm,onSubmit:function(e){e.preventDefault(),r&&l(!0)},children:[Object(B.jsx)("input",{className:e.searchInput,placeholder:"Search...",value:r,onFocus:function(){r&&l(!0)},onChange:function(e){!function(e){c(e.target.value)}(e)}}),Object(B.jsx)(A.a,{type:"submit",children:Object(B.jsx)(Wt.a,{})})]}),o&&Object(B.jsx)(Gt,{searchText:r})]})})},Yt=Object(d.a)((function(e){return{root:Object(ct.a)({position:"relative",display:"flex",flexDirection:"column",maxWidth:"400px",minWidth:"400px",height:"100vh"},e.breakpoints.down("sm"),{minWidth:"100%"})}}));var qt=function(e){var t=e.setShowChangeProfilePicture,n=Object(vt.a)(),a=Yt();return Object(B.jsxs)(m.a,{className:a.root,borderRight:"2px solid ".concat(n.palette.grey[200]),children:[Object(B.jsxs)(m.a,{px:2,py:3,display:"flex",alignItems:"center",justifyContent:"space-between",children:[Object(B.jsx)(ut,{setShowChangeProfilePicture:t}),Object(B.jsx)(ot,{})]}),Object(B.jsx)(Ht,{}),Object(B.jsx)(Ut,{})]})},Vt=n(394),Kt=n(379),Zt=n(380),Xt=Object(d.a)((function(e){return{modal:{display:"flex",justifyContent:"center",alignItems:"center"},modal__content:{height:"600px",width:"400px",borderRadius:"10px",backgroundColor:e.palette.background.paper,boxShadow:e.shadows[5],outline:"none"},avatar:{margin:"1em 0",height:"170px",width:"170px"},btnsContainer:{margin:"1.5em 0"},greetingText:{marginTop:"0.3em"},infoText:{fontSize:"1.2rem"},fullNameText:{marginTop:"1.5em",fontSize:"1.8rem",fontWeight:"bold",color:"#2e2e2e"},usernameText:{marginTop:"0.3em",marginBottom:"0.8em",fontSize:"1.4rem",fontWeight:"500",color:"#2e2e2e"},btn:{margin:"0.5em 0",padding:"0.5em",width:"75%","&:last-child":{margin:"3em 0"}}}}));var Jt=function(e){var t=e.greeting,n=e.setShowChangeProfilePicture,r=Xt(),c=Object(a.useContext)(Ve),i=c.LoggedInUser,s=c.setLoggedInUser,o=Object(a.useState)(i.profilePic),l=Object(j.a)(o,2),u=l[0],d=l[1],b=Object(a.useState)(),h=Object(j.a)(b,2),x=h[0],g=h[1],v=Object(a.useState)(!0),y=Object(j.a)(v,2),w=y[0],k=y[1],N=Object(a.useState)(!1),I=Object(j.a)(N,2),E=I[0],A=I[1],L=Object(a.useState)(),F=Object(j.a)(L,2),P=F[0],M=F[1];function U(){return(U=Object(p.a)(f.a.mark((function e(){var t,n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!x){e.next=18;break}return e.prev=1,A(!0),e.next=5,S.post("/uploadprofilepic",{data:u});case 5:t=e.sent,A(!1),M({type:"success",message:t.data.message}),s((function(e){var n=Object(C.a)({},e);return n.profilePic=t.data.profilePicURL,n})),setTimeout(z,2100),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(1),M({type:"error",message:(null===(n=e.t0.response)||void 0===n?void 0:n.data.message)||e.t0.message}),A(!1);case 16:e.next=19;break;case 18:M({type:"warning",message:"select image first"});case 19:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function z(){k(!1),n&&n(!1)}return Object(B.jsx)(B.Fragment,{children:Object(B.jsx)(Vt.a,{className:r.modal,open:w,children:Object(B.jsxs)(m.a,{display:"flex",flexDirection:"column",alignItems:"center",className:r.modal__content,children:[P?Object(B.jsx)(Q,{type:P.type,children:P.message}):null,Object(B.jsxs)(O.a,{className:r.fullNameText,variant:"h5",align:"center",children:[i.firstName," ",i.lastName]}),Object(B.jsxs)(O.a,{className:r.usernameText,variant:"h6",align:"center",children:["@",i.username]}),Object(B.jsx)(O.a,{className:"".concat(r.txtWhite," ").concat(r.infoText),align:"center",children:t?Object(B.jsxs)(B.Fragment,{children:["Welcome to Messenger.",Object(B.jsx)("br",{}),"Set your Profile Picture to continue."]}):null}),Object(B.jsx)(be.a,{className:r.avatar,src:u,alt:"avatar"}),E?Object(B.jsx)(R.a,{size:"2rem"}):null,Object(B.jsxs)(m.a,{display:"flex",flexDirection:"column",alignItems:"center",width:1,mt:"auto",mb:"2em",children:[Object(B.jsx)("input",{accept:"image/*",style:{display:"none"},id:"raised-button-file",type:"file",onChange:function(e){var t=new FileReader;e.target.files[0]&&t.readAsDataURL(e.target.files[0]),t.addEventListener("load",(function(){g(t.result),d(t.result)}))}}),Object(B.jsx)(T.a,{className:r.btn,variant:"contained",component:"label",htmlFor:"raised-button-file",color:"primary",endIcon:Object(B.jsx)(Kt.a,{}),children:"Choose"}),Object(B.jsx)(T.a,{className:r.btn,onClick:function(){return U.apply(this,arguments)},variant:"contained",component:"span",color:"primary",endIcon:Object(B.jsx)(Zt.a,{}),children:"Upload"}),Object(B.jsx)(T.a,{className:r.btn,variant:"contained",color:"secondary",onClick:z,children:t?"Skip Now":"Close"})]})]})})})},Qt=n(381),_t=n(382),$t=n(383),en=n(384);function tn(e){var t=new Date,n=t.getHours()-e.getHours(),a=function(){var a=t.getMinutes()-e.getMinutes();return a<0&&(a+=60,n--),a}(),r=function(){var n=t.getSeconds()-e.getSeconds();return n<0&&(n+=60,a--),n}();return"".concat(n>0?("0"+n).slice(-2)+":":"").concat(("0"+a).slice(-2),":").concat(("0"+r).slice(-2))}var nn=function(e){var t=e.callStartedTime,n=e.callState,r=Object(a.useState)(),c=Object(j.a)(r,2),i=c[0],s=c[1];return Object(a.useEffect)((function(){if(t&&(s(tn(t)),![In.HANGUP,In.CONNECTIONLOST].includes(n))){var e=setInterval((function(){s(tn(t))}),1e3);return function(){clearInterval(e)}}}),[t,n]),Object(B.jsx)(B.Fragment,{children:i})};var an=function(e){Object(a.useEffect)((function(){if(e&&"noAnswer"!==e&&"busy"!==e&&"ongoing"!==e){var t=new Audio("/sounds/".concat(e,".mp3"));t.load(),"connecting"!==e&&"ringing"!==e&&"reconnecting"!==e||(t.loop=!0),t.play()}return function(){t&&t.pause()}}),[e])},rn=Object(d.a)((function(e){return{call_alert:{width:"fit-content",padding:"1em",display:"flex",alignItems:"center",position:"absolute",left:"50%",transform:"translateX(-50%) !important",top:"5px",zIndex:"2000",borderRadius:"20px",backgroundColor:e.palette.background.paper},call_animation:{width:"3em",height:"3em",display:"flex",justifyContent:"center",alignItems:"center",position:"relative",borderRadius:"50%",animation:"$ripple 2s ease infinite",webkitBackfaceVisibility:"hidden",mozBackfaceVisibility:"hidden",msBackfaceVisibility:"hidden",backfaceVisibility:"hidden"},"@keyframes ripple":{"0%":{transform:" scale(1)"},"15%":{boxShadow:"0 0 0 3px"+("dark"===e.palette.type?"#ffffff66":"#aadff866")},"25%":{boxShadow:" 0 0 0 5px"+("dark"===e.palette.type?"#ffffff66":"#aadff866")+", 0 0 0 10px"+("dark"===e.palette.type?"#ffffff33":"#aadff833")}},avatar:{height:"2.5em",width:"2.5em"},callerName:{fontSize:"1.1rem"}}})),cn=Object(d.a)((function(e){return{button:{marginLeft:"0.2em",backgroundColor:e.palette.background.default},button_incoming:{margin:"0 0.2em",backgroundColor:e.palette.background.default,animation:"$vibrate 100ms infinite alternate ease-in-out"},"@keyframes vibrate":{from:{transform:"rotateZ(-5deg) translateY(0px)"},to:{transform:"rotateZ(5deg) translateY(1px)"}}}}));function sn(e){var t=e.callState,n=e.callStartedTime,a=Object(q.a)();return Object(B.jsx)(O.a,{style:{color:function(){switch(t){case In.CALLFAILED:case In.CONNECTIONLOST:case"hangup":return a.palette.error.main;case In.NOANSWER:case In.BUSY:return a.palette.warning.main;default:return a.palette.text.secondary}}()||a.palette.text.secondary},variant:"body1",children:{connecting:"connecting. . .",connected:"connected",callFailed:"call Failed!",calling:"calling. . .",ringing:"Incoming Call. . .",noAnswer:"No Answer!",busy:"Busy!",ongoing:Object(B.jsx)(nn,{callStartedTime:n,callState:t}),reconnecting:"Reconnecting. . .",connectionLost:Object(B.jsxs)("span",{children:[Object(B.jsx)(nn,{callStartedTime:n,callState:t}),"\tConnection Lost!"]}),hangup:Object(B.jsxs)("span",{children:[Object(B.jsx)(nn,{callStartedTime:n,callState:t}),"\tcall Ended!"]})}[t]})}function on(e){var t=e.disabled,n=e.muted,a=e.setMuted,r=Object(q.a)(),c=cn();return Object(B.jsx)(A.a,{className:c.button,disabled:t,onClick:function(){a(!n)},children:n?Object(B.jsx)(Qt.a,{htmlColor:r.palette.grey[500]}):Object(B.jsx)(_t.a,{htmlColor:r.palette.grey[500]})})}function ln(e){var t=e.callType,n=e.callingUser,a=Object(q.a)(),r=cn();return Object(B.jsx)(A.a,{className:r.button_incoming,onClick:function(){var e=new CustomEvent("call",{detail:{callingUser:n,callType:t}});document.dispatchEvent(e)},children:Object(B.jsx)($t.a,{htmlColor:a.palette.success.main})})}function un(e){var t=e.callType,n=Object(q.a)(),a=cn();return Object(B.jsx)(A.a,{className:a.button_incoming,onClick:function(){var e=new CustomEvent("callAccepted");document.dispatchEvent(e)},children:{AudioCall:Object(B.jsx)($t.a,{htmlColor:n.palette.success.main}),VideoCall:Object(B.jsx)(ke.a,{htmlColor:n.palette.success.main})}[t]})}function dn(){var e=Object(q.a)(),t=cn();return Object(B.jsx)(A.a,{className:t.button,onClick:function(){var e=new CustomEvent("callEnd");document.dispatchEvent(e)},children:Object(B.jsx)(en.a,{htmlColor:e.palette.error.main})})}function mn(e){var t=e.callType,n=e.callState,a=e.callingUser,r=e.muted,c=e.setMuted;switch(!0){case[In.CONNECTING,In.CONNECTED,In.CALLING,In.ONGOING,In.RECONNECTING].some((function(e){return e===n})):return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(on,{disabled:n!==In.ONGOING,muted:r,setMuted:c}),Object(B.jsx)(dn,{})]});case[In.CALLFAILED,In.NOANSWER,In.BUSY,In.CONNECTIONLOST].some((function(e){return e===n})):return Object(B.jsx)(ln,{callType:t,callingUser:a});case n===In.RINGING:return Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(un,{callType:t}),Object(B.jsx)(dn,{})]});default:return null}}var jn=function(e){var t=e.direction,n=e.callType,r=e.callState,c=e.callingUser,i=e.remoteStream,s=e.localStream,o=e.callStartedTime,l=rn(),u=Object(a.createRef)(null),d=Object(a.useRef)(),b=Object(a.useState)(!1),f=Object(j.a)(b,2),p=f[0],h=f[1];return an(r),Object(a.useEffect)((function(){s&&s.getAudioTracks().forEach((function(e){return e.enabled=!p}))}),[p,s]),Object(a.useEffect)((function(){i&&(d.current.srcObject=i,d.current.play())}),[i]),Object(B.jsx)(V.a,{direction:"down",in:!0,timeout:{enter:200,exit:500},children:Object(B.jsxs)(m.a,{className:l.call_alert,boxShadow:5,ref:u,children:[i&&Object(B.jsx)("audio",{ref:d,autoPlay:!0}),Object(B.jsx)("div",{className:l.call_animation,children:Object(B.jsx)(be.a,{className:l.avatar,src:c.profilePic,alt:"user"})}),Object(B.jsxs)(m.a,{mx:"1em",style:{WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",userSelect:"none"},children:[Object(B.jsx)(sn,{callState:r,callStartedTime:o}),Object(B.jsxs)(O.a,{color:"textPrimary",style:{fontSize:"1.1em"},children:[c.firstName," ",c.lastName]})]}),Object(B.jsx)(mn,{callState:r,callType:n,direction:t,muted:p,setMuted:h})]})})},bn=n(171),fn=n.n(bn),pn=n(385),hn=n(386),On=Object(d.a)({root:{position:"absolute",top:"100%",transform:"translateY(-100%)",marginTop:"-2em"},actionBtn:{height:"2.5em",width:"2.5em",margin:"0 0.8em","&:nth-child(1),&:nth-child(2)":{backgroundColor:"#7c7c7c62",backdropFilter:"blur(5px)",webkitBackdropFilter:"blur(5px)"},"&:last-child":{backgroundColor:"#ff0000",backdropFilter:"blur(5px)",webkitBackdropFilter:"blur(5px)"}}});var xn=function(e){var t=e.muted,n=e.cameraEnabled,r=e.setMuted,c=e.setCameraEnabled,i=On(),s=Object(a.useRef)(new Event("callEnd"));return Object(B.jsx)(m.a,{className:i.root,children:Object(B.jsxs)(m.a,{className:i.ActionButtons,children:[Object(B.jsx)(A.a,{className:i.actionBtn,onClick:function(){c(!n)},children:n?Object(B.jsx)(pn.a,{htmlColor:"white"}):Object(B.jsx)(hn.a,{htmlColor:"white"})}),Object(B.jsx)(A.a,{className:i.actionBtn,onClick:function(){r(!t)},children:t?Object(B.jsx)(Qt.a,{htmlColor:"white"}):Object(B.jsx)(_t.a,{htmlColor:"white"})}),Object(B.jsx)(A.a,{className:i.actionBtn,onClick:function(){var e=s.current;document.dispatchEvent(e)},children:Object(B.jsx)(en.a,{htmlColor:"white"})})]})})},gn=n(387),vn=n(388),yn=Object(d.a)((function(e){return{videoCallHeader:{position:"absolute",zIndex:"1000",backgroundColor:"#7c7c7c62",backdropFilter:"blur(5px)",webkitBackdropFilter:"blur(5px)",width:"100%",padding:"0.8em",alignSelf:"stretch",display:"flex",justifyContent:"space-between"},userInfoContainer:{display:"flex",alignItems:"center",margin:"0 0.5em"},headerBtn:{margin:"0 0.5em"},wrapper:{color:"#fff",marginLeft:"1em"},timer:{color:e.palette.grey[300]},avatar:{height:"2.3em",width:"2.3em"}}}));var wn=function(e){var t=e.callState,n=e.callingUser,r=e.callStartedTime,c=yn(),i=Object(a.useState)(!1),s=Object(j.a)(i,2),o=s[0],l=s[1];return Object(B.jsxs)(m.a,{className:c.videoCallHeader,children:[Object(B.jsxs)(m.a,{className:c.userInfoContainer,children:[Object(B.jsx)(be.a,{className:c.avatar,src:n.profilePic}),Object(B.jsxs)(m.a,{className:c.wrapper,children:[Object(B.jsxs)(O.a,{variant:"h6",className:c.username,children:[n.firstName," ",n.lastName]}),t===In.ONGOING&&Object(B.jsx)(O.a,{variant:"subtitle2",className:c.timer,children:Object(B.jsx)(nn,{callStartedTime:r,callState:t})})]})]}),Object(B.jsx)(m.a,{className:c.headerBtnsContainer,children:Object(B.jsx)(A.a,{className:c.headerBtn,onClick:function(){document.fullscreenElement?document.exitFullscreen&&(document.exitFullscreen(),l(!1)):(document.documentElement.requestFullscreen(),l(!0))},children:o?Object(B.jsx)(gn.a,{htmlColor:"white"}):Object(B.jsx)(vn.a,{htmlColor:"white"})})})]})},Sn=Object(d.a)({videoContainer:{height:"100%",width:"100%","&>video":{width:"100%",height:"100%",objectFit:"contain"}},localVideoContainer:{position:"absolute",height:"20vh",top:"6em",right:"1em",backgroundColor:"white","&>video":{height:"100%",width:"100%",objectFit:"contain"}}});var Cn=function(e){var t=e.localVideo,n=e.remoteVideo,a=Sn();return Object(B.jsxs)(m.a,{className:a.videoContainer,children:[Object(B.jsx)(m.a,{className:a.localVideoContainer,children:Object(B.jsx)("video",{ref:t,autoPlay:!0,muted:!0})}),Object(B.jsx)("video",{ref:n,autoPlay:!0})]})},kn=Object(d.a)({root:{position:"absolute",zIndex:"1000",display:"flex",flexDirection:"column",alignItems:"center",left:0,width:"100%",height:"100%",backgroundColor:"black"}});var Nn=function(e){var t=e.localStream,n=e.remoteStream,r=e.callState,c=e.callingUser,i=e.callStartedTime,s=kn(),o=Object(a.useRef)(),l=Object(a.useRef)(),u=Object(a.useState)(!1),d=Object(j.a)(u,2),b=d[0],f=d[1],p=Object(a.useState)(!0),h=Object(j.a)(p,2),O=h[0],x=h[1];return Object(a.useEffect)((function(){l.current.srcObject=n,o.current.srcObject=t}),[n,t]),Object(a.useEffect)((function(){t.getAudioTracks().forEach((function(e){return e.enabled=!b}))}),[b,t]),Object(a.useEffect)((function(){t.getVideoTracks().forEach((function(e){return e.enabled=O}))}),[O,t]),Object(B.jsxs)(m.a,{className:s.root,children:[Object(B.jsx)(wn,{callState:r,callingUser:c,callStartedTime:i}),Object(B.jsx)(Cn,{localVideo:o,remoteVideo:l}),Object(B.jsx)(xn,{muted:b,cameraEnabled:O,setMuted:f,setCameraEnabled:x})]})},In={CONNECTING:"connecting",CONNECTED:"connected",CALLFAILED:"callFailed",CALLING:"calling",RINGING:"ringing",NOANSWER:"noAnswer",BUSY:"busy",ONGOING:"ongoing",RECONNECTING:"reconnecting",CONNECTIONLOST:"connectionLost",HANGUP:"hangup"},En="incoming",An="outgoing",Tn="VideoCall";var Rn=function(){var e=Object(a.useContext)(xe),t=Object(a.useContext)(Ve).LoggedInUser,n=Object(a.useState)(),r=Object(j.a)(n,2),c=r[0],i=r[1],s=Object(a.useState)(),o=Object(j.a)(s,2),l=o[0],u=o[1],d=Object(a.useState)(!1),m=Object(j.a)(d,2),b=m[0],f=m[1],p=Object(a.useState)(),h=Object(j.a)(p,2),O=h[0],x=h[1],g=Object(a.useState)(),v=Object(j.a)(g,2),y=v[0],w=v[1],S=Object(a.useState)(),C=Object(j.a)(S,2),k=C[0],N=C[1],I=Object(a.useState)(),E=Object(j.a)(I,2),A=E[0],T=E[1],R=Object(a.useState)(),L=Object(j.a)(R,2),F=L[0],P=L[1],M=!(y===En&&O===In.CONNECTING)&&O&&!b,U=function(){f(!1),x(),i(),u(),w(),N(),T(),P()},z=Object(a.useCallback)((function(n){var a,r,c=n.detail?An:En,s=(null===(a=n.detail)||void 0===a?void 0:a.callType)||n.callType;w(c),T((null===(r=n.detail)||void 0===r?void 0:r.userInfo)||n.caller),N(s),x(In.CONNECTING);var o=new fn.a;o.on("open",(function(a){if(c===An){var r=n.detail.userInfo;e.emit("outgoingCall",a,r,s),e.on("acknowledgedCall",(function(e,n,a,c){n.username===t.username&&a===r.username&&c===s&&(x(In.CONNECTED),function(e,t,n){navigator.mediaDevices.getUserMedia({video:n===Tn,audio:!0}).then((function(a){u(a),f(n===Tn);var r=e.call(t,a);x(In.CALLING),r.on("stream",(function(e){i(e),P(new Date),x(In.ONGOING)}))})).catch((function(e){x(In.CALLFAILED),console.error("Failed to get local stream",e)}))}(o,e,s))}))}else N(n.callType),x(In.RINGING),e.emit("callAcknowledged",a,n.caller,t.username,n.callType)})),o.on("call",(function(e){x(In.RINGING),document.addEventListener("callAccepted",(function(){!function(e,t){navigator.mediaDevices.getUserMedia({video:t===Tn,audio:!0}).then((function(n){e.answer(n),u(n),e.on("stream",(function(e){P(new Date),x(In.ONGOING),i(e),f(t===Tn)}))})).catch((function(e){x(In.CALLFAILED),console.error("Failed to get local stream",e)}))}(e,s)}))}))}),[e,t]),G=Object(a.useCallback)((function(){null===c||void 0===c||c.getTracks().forEach((function(e){return e.stop()})),null===l||void 0===l||l.getTracks().forEach((function(e){return e.stop()}))}),[c,l]),W=Object(a.useCallback)((function(){this!==e&&(O===In.RINGING?e.emit("callRejected",A):e.emit("callEnd",A)),x(In.HANGUP),G(),setTimeout(U,2e3)}),[e,A,O,G]);return Object(a.useEffect)((function(){switch(O){case In.CONNECTING:var t=setTimeout((function(){x(In.CALLFAILED),setTimeout(U,3e3)}),1e4);break;case In.RINGING:var n=setTimeout((function(){e.emit("noAnswer",A),U()}),1e4);break;case In.NOANSWER:case In.BUSY:setTimeout(U,3e3),G()}return function(){clearTimeout(t),clearTimeout(n)}}),[e,O,A,G]),Object(a.useEffect)((function(){return e.on("incomingCall",z),e.on("callEnd",W),e.on("noAnswer",(function(){x(In.NOANSWER)})),e.on("callRejected",(function(){x(In.BUSY)})),e.on("userBusy",(function(e){A===e&&x(In.BUSY)})),document.addEventListener("call",z),document.addEventListener("callEnd",W),function(){document.removeEventListener("call",z),document.removeEventListener("callEnd",W),e.off("incomingCall",z),e.off("callEnd",W)}}),[e,A,z,W]),Object(B.jsxs)(B.Fragment,{children:[M&&Object(B.jsx)(jn,{direction:y,callType:k,callingUser:A,callState:O,callStartedTime:F,remoteStream:c,localStream:l}),b&&Object(B.jsx)(Nn,{localStream:l,remoteStream:c,callState:O,callingUser:A,callStartedTime:F})]})};var Ln=function(){var e=localStorage.getItem("accesstoken"),t=Object(je.a)(v.wsAddress,{auth:{token:e}}),n=Object(me.a)(e),r=Object(q.a)(),c=Object(a.useState)(!1),i=Object(j.a)(c,2),s=i[0],o=i[1],l=Object(a.useState)(!1),d=Object(j.a)(l,2),b=d[0],f=d[1],p=Object(de.a)(r.breakpoints.down("sm"));Object(a.useEffect)((function(){return t.on("connect",(function(){console.log("socket connected")})),t.on("disconnect",(function(){console.log("socket disconnected!")})),S.get("/userinfo/".concat(n.username)).then((function(e){e.data.newUser&&(o(!0),f(!0))})),function(){t.disconnect()}}),[t,n.username]);var h=Object(a.useState)(n),O=Object(j.a)(h,2),x={LoggedInUser:O[0],setLoggedInUser:O[1]};return Object(B.jsx)(xe.Provider,{value:t,children:Object(B.jsx)(Ve.Provider,{value:x,children:Object(B.jsxs)(m.a,{display:"flex",minHeight:"100vh",position:"relative",bgcolor:r.palette.background.default,children:[s&&Object(B.jsx)(Jt,{greeting:b,setShowChangeProfilePicture:o}),p?Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(u.b,{path:"/messenger",exact:!0,children:Object(B.jsx)(qt,{setShowChangeProfilePicture:o})}),Object(B.jsx)(u.b,{path:"/messenger/:username",exact:!0,children:Object(B.jsx)(rt,{})})]}):Object(B.jsxs)(B.Fragment,{children:[Object(B.jsx)(qt,{setShowChangeProfilePicture:o}),Object(B.jsx)(u.b,{path:"/messenger/:username?",children:Object(B.jsx)(rt,{})})]}),Object(B.jsx)(Rn,{})]})})})};var Fn=function(e){var t=e.children;return localStorage.getItem("accesstoken")?t:Object(B.jsx)(u.a,{to:"/login"})},Pn=Object(s.a)({palette:{type:"light",primary:{main:"#00ab55"},background:{paper:"#fff",default:"#fff"}},breakpoints:{values:{xs:0,sm:600,md:900,lg:1280,xl:1920}}});function Bn(){return Object(B.jsx)(l.a,{children:Object(B.jsx)(o.a,{theme:Pn,children:Object(B.jsxs)(u.d,{children:[Object(B.jsx)(u.b,{path:["/","/login","/signup"],exact:!0,children:Object(B.jsx)(ue,{})}),Object(B.jsx)(u.b,{path:"/messenger/:username?",children:Object(B.jsx)(Fn,{children:Object(B.jsx)(Ln,{})})})]})})})}i.a.render(Object(B.jsx)(r.a.StrictMode,{children:Object(B.jsx)(Bn,{})}),document.getElementById("root"))}},[[312,1,2]]]);
//# sourceMappingURL=main.029d656b.chunk.js.map